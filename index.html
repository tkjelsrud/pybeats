<html>
<head>
<script>
  var grid = {};
  grid['BD'] = new Array(1, 0, 0, 0);
  grid['SD'] = new Array(0, 1, 0, 1);

  var snd = new Audio("piano2.wav"); // buffers automatically when created
  snd.play();

  // bpm 120 = 120 / 60 = 2 pr sec

  var beatBar = 4;
  var bpm = 120;
  var bpms = 1000 / (bpm/60);
  var mibeat = 16;
  var mbms = 1000 / ((bpm/60) * mibeat);
  var sTime = new Date();
  
  function Timer() {
  	// Now what
    diff = (new Date()).getTime() - sTime.getTime();
    
    return {'beat': parseInt(diff / bpms), 'mbeat': parseInt(diff / mbms)};
  }
  
  var i = 0, limit = 200, busy = false; 

  var processor = setInterval(function() {
    lBeat = Timer();
    
    if(!busy) {
      busy = true;
      nBeat = (Timer());
      cBeat = 0;
      
      if(lBeat['beat'] != nBeat['beat']) {
        // New beat yall
        document.getElementById("bt_" + cBeat).style.backgroundColor = 'white';
        cBeat = nBeat['beat'] % beatBar;
        console.log(cBeat);
        document.getElementById("bt_" + cBeat).style.backgroundColor = 'green';
        lBeat = nBeat();
      }
      //console.log(Timer());
      
      busy = false;
    }
  }, 100);
</script>
</head>

<body>
Test
  
  <div id="bt_0">1</div>
  <div id="bt_1">2</div>
  <div id="bt_2">3</div>
  <div id="bt_3">4</div>
</body>
</html>
