<html>
<head>
  <style type="text/css">
    .beat {
      float: left;
    }
  </style>
<script>
  /*var grid = {};
  grid['BD'] = new Array(1, 0, 0, 0);
  grid['SD'] = new Array(0, 1, 0, 1);

  var snd = new Audio("piano2.wav"); // buffers automatically when created
  snd.play();*/

  // bpm 120 = 120 / 60 = 2 pr sec

  var beatBar = 4;
  var bpm = 120;
  var bpms = 1000 / (bpm/60);
  var mibeat = 16;
  var mbms = 1000 / ((bpm/60) * mibeat);
  var sTime = new Date();
  
  function Timer() {
  	// Now what
    diff = (new Date()).getTime() - sTime.getTime();
    
    return {'beat': parseInt(diff / bpms), 'mbeat': parseInt(diff / mbms)};
  }
  
  var i = 0, limit = 200, busy = false; 

  lBeat = Timer();
  cBeat = 0;
    
  var processor = setInterval(function() {

    if(!busy) {
      busy = true;
      nBeat = (Timer());
      
      if(lBeat['beat'] != nBeat['beat']) {
        // New beat yall
        document.getElementById("bt_" + cBeat).style.backgroundColor = 'white';
        cBeat = nBeat['beat'] % beatBar;
        console.log(cBeat);
        document.getElementById("bt_" + cBeat).style.backgroundColor = 'green';
        lBeat = nBeat;
      }
      else if(lBeat['mbeat'] != nBeat['mbeat']) {
        // New micro beat
        // Do something, anything...
        
      }
      
      
      busy = false;
    }
  }, 50);
</script>
</head>

<body>
Test
  
  <div id="bt_0" class="beat">1</div>
  <div id="bt_1" class="beat">2</div>
  <div id="bt_2" class="beat">3</div>
  <div id="bt_3" class="beat">4</div>
</body>
</html>
